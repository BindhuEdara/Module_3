<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
</head>
<body>
  <h2>Firebase CRUD Using Fetch</h2>
  <input type="text" id="title" placeholder="Enter title">
  <input type="text" id="author" placeholder="Enter author">
  <input type="text" id="price" placeholder="price">
  <input type="text" id="imageUrl" placeholder="Enter image URL (optional)" />

  <button onclick="addBook()">Add Book</button>

  <div id="bookList"></div>
</body>

<script>
  const BASE_URL = "https://bookmanagement-353d9-default-rtdb.asia-southeast1.firebasedatabase.app/"
  async function addBook() {
      const title = document.getElementById("title").value.trim();
      const author = document.getElementById("author").value.trim();
      const price = document.getElementById("price").value.trim();
      const imageUrl = document.getElementById("imageUrl").value.trim();

      if(!title || !author || !price){
        alert("please eneter title and author and price");
        return;
      }

      const data = {title, author, price, imageUrl};
      try{
      await fetch(`${BASE_URL}/books.json`, {
        method: "POST",
        body: JSON.stringify(data)
      })
      alert("book added successfully");

      document.getElementById("title").value="";
      document.getElementById("author").value="";
      document.getElementById("price").value="";
      document.getElementById("imageUrl").value = "";

      getBooks();
    } catch(error){
      console.log("error");
    }
  }

  async function getBooks(){
    try{
      const res = await fetch(`${BASE_URL}/books.json`);
      const data = await res.json();

      const booksArray = data ? Object.entries(data).map(([id, book])=>({
        id,
        ...book
      })) : [];
      renderBooks(booksArray);
    } catch(error){
      console.log(error)
    }
  }

  function renderBooks(books){
    const mainDiv = document.getElementById("bookList");
    mainDiv.innerHTML="";
    books.forEach((book)=> {
      console.log(book);
      let card = document.createElement("div");
      card.className = "card";

      let image = document.createElement("img");
      image.src = book.imageUrl;

      let title = document.createElement("h3");
      title.textContent = book.title;

      let author = document.createElement("h3");
      author.textContent = book.author;

      let price = document.createElement("h3");
      price.textContent = `Price:${book.price}`;

      let editBtn = document.createElement("button");
      editBtn.className = "btnEdit";
      editBtn.textContent = "Edit";
      editBtn.onclick = () => updateBook(book.id, book.title, book.author, book.price,book.imageUrl);

      let deleteBtn = document.createElement("button");
      deleteBtn.className = "btnDel";
      deleteBtn.textContent = "Delete";
      deleteBtn.onclick= () =>deleteBook(book.id)


      book.appendChild(imageUrl);
      book.appendChild(title);
      book.appendChild(author);
      book.appendChild(price);
      book.appendChild(editBtn);
      book.appendChild(deleteBtn);

      mainDiv.appendChild(card);
    })
  }

  async function updateBook(id, oldTitle, oldAuthor, oldPrice, oldImageUrl){
    const title  = prompt("enter the title", oldTitle);
    const author = prompt("enter new author", oldAuthor);
    const price = prompt("enter new Price", oldPrice);
    const imageUrl = prompt("Enter image URL (optional)", oldImageUrl || "");

    if(!title || !author || !price) return;

    await(`${BASE_URL}/books/${id}.json`,{
      method: "PATCH",
      body: JSON.stringify(updateBook)
    })
    alert("book Updated!");
    getBooks();
  }
   async function deleteBook(id) {
      await fetch(`${BASE_URL}/books/${id}.json`, {
        method: "DELETE" // DELETE request
      });

      alert("Book deleted!");

      getBooks(); // Refresh list
    }

    getBooks(); // Load users on page load
</script>
</html>
